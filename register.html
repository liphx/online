<!DOCTYPE html>
<html><head><meta charset="UTF-8">
<script src="js/jquery-3.3.1.min.js" type="text/javascript"></script>
<script src="js/verification-code.js" type="text/javascript"></script>
<link rel="stylesheet" href="css/register.css">

</head>
<body>

<h1>欢迎加入我们</h1>
    <form id=form-register>
        <div>
            <label>账号</label>
            <input id="username" type="text"  class="required" maxlength="15" >
        </div>
        <div>
            <label>密码</label>
            <input id="password" type="password" maxlength="20">
        </div>
        <div>
            <label>邮箱</label>
            <input type="email" id="email" maxlength="50" >
        </div>
        <div>  
                <label>验证码</label>
                <input type = "text" id = "input" value="" />  
                <input type = "button" id="code" onclick="createCode()"/>  
                
        </div> 
        <br>
        <div>
            <input type="submit" id="button" value="注册" >
        </div>
    </form>
	
    <script>
        $(document).ready(function(){


            $("#username").blur(function(){
                var $parent = $(this).parent();
                $parent.find(".error").remove();
                var regname = $.trim(this.value);
                var pattern = /^\w{2,15}$/;
            
                if(regname == ""||!pattern.test(regname)){
                $parent.append("<span class='error'>" + "用户名格式错误" + "</span>");                    
                return false;
                }
                else {
                    $parent.append("<span class='success'>" + "OK" + "</span>");
                    return true;
                }
            });

            $("#password").blur(function(){
                var $parent = $(this).parent();
                $parent.find(".error").remove();
                var regpass = $.trim(this.value);
                var pattern = /^\w{6,20}$/;
            
                if(regpass == ""||!pattern.test(regpass)){
                $parent.append("<span class='error'>" + "密码格式错误" + "</span>");                    
                return false;
                }
                else {
                    $parent.append("<span class='success'>" + "OK" + "</span>");
                    return true;
                }
            });

            $("#email").blur(function(){
                var $parent = $(this).parent();
                $parent.find(".error").remove();
                var regemail = $.trim(this.value);
                var pattern = /.+@.+\.[a-zA-Z]{2,4}$/;
              
                if(regemail == ""||!pattern.test(regemail)){
                $parent.append("<span class='error'>" + "邮箱格式错误" + "</span>");                    
                return false;
                }
                else {
                    $parent.append("<span class='success'>" + "OK" + "</span>");
                    return true;
                }
            });


            $("#button").click(function(){
                var userName=$("#username").val();
                var pass=$("#password").val();
                var Email=$("#email").val();
                if(userName == ""||pass == ""||Email == ""){
                    alert("请填写信息完整");
                    return false;
                }
                else{
                    if(validate()){
                        $.post("../back-end/register.php",
                          {                          
                             name:userName,
                             password:pass,
                             email:Email
                          },
                          function(data,status){
                            if(data.status){
                               alert("注册成功，去登录");
                               location.href="login.html";
                            }
                            else{
                               createCode();
                               alert("注册失败");
                            }
                          },
                        "json"                      
                        );
                    
                    }
                    return false;
                }
                             
            });
        });
       
    </script>
               
      
<ul>
  <li>已经拥有帐号? <a href="login.html">直接登录</a></li>
</ul>
</body>
</html>

